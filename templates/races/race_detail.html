{% extends base_template_name|default:"base.html" %}


{% load url from future %}
{% load core_tags %}
{% load faq_tags %}
{% load flickr %}
{% load links_tags %}
{% load mailhide %}
{% load markup %}
{% load news_tags %}
{% load photo_tags %}
{% load race_tags %}
{% load share_tags %}
{% load sponsors_tags %}
{% load waffle_tags %}


{% switch use_thumbor %}
{% load thumbor_tags %}
{% endswitch %}

{% block title %}{{object.title}}{% if object.get_overall_results %} Results{% endif %}{% endblock title %}


{% block post_style %}
<style>
#map { height: 240px; }
</style>
{% endblock post_style %}


{% block post_script %}
{% if object.is_geocoded %}
<script>
var map = L.map('map', {
    center: [{{ object.latitude }}, {{ object.longitude }}],
    zoom: 15,
    scrollWheelZoom: false
});

L.tileLayer('http://{s}.tile.cloudmade.com/4a880035a5364f75a7bfbcbf22175258/997/256/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
    maxZoom: 50
}).addTo(map);

var marker = L.marker([{{ object.latitude }}, {{ object.longitude }}]).addTo(map);
/*
var circle = L.circle([38.972013,-95.22], 500, {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5
}).addTo(map);

var polygon = L.polygon([
    [51.509, -0.08],
    [51.503, -0.06],
    [51.51, -0.047]
]).addTo(map);
*/
</script>
{% endif %}
{% endblock post_script %}


{% block content %}
<div class="row">
    <div class="col-md-8">

		<h1>{{ object.title }} <small>{{ object.start_datetime|date }}</small></h1>

        {% if object.logo %}
		<div class="row">
		    <div class="col-md-12">
		        {% switch use_thumbor %}
	         	<img class="img-response" src="{% thumbor_url object.logo.url width=600 %}">
	         	{% else %}
	         	<img class="img-response" src="{{ object.logo.url }}">
        		{% endswitch use_thumbor %}
	    	</div>
    	</div>
        {% endif %}

		<div class="alert alert-danger">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<h4>Warning!</h4>
			Best check yo self, you're not...
		</div>

		<div class="alert alert-warning">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<h4>Warning!</h4>
			Best check yo self, you're not...
		</div>

		<div class="alert alert-info">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<h4>Warning!</h4>
			Best check yo self, you're not...
		</div>

		<div class="alert alert-success">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<h4>Warning!</h4>
			Best check yo self, you're not...
		</div>

		{% if not object.is_finished %}
		<p><a class="btn btn-primary btn-lg btn-block" href="{{ object.reg_url }}">REGISTER TODAY</a></p>

		{% if object.registration_set.count %}
		<table class="table table-hover table-striped">
			<thead>
				<tr>
					<th>Price level</th>
					<th>Dates</th>
					<th>Price</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				{% for registration in object.registration_set.all %}
				<tr class="{% if registration.has_expired %}highlight{% endif %}">
					<td>{{ registration.description }}</td>
					<td>{{ registration.reg_date|date }} {% if registration.end_date %} to {{ registration.end_date|date }}{% endif %}</td>
					<td>${{ registration.reg_cost }}</td>
					<td><p><a class="btn btn-sm btn-block btn-warning" href="{{ object.reg_url }}">register!</a></p></td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
		{% endif %}

		{% endif %}

		<h2>Event Information</h2>

		<h3>Location</h3>
		{% comment %}
		{% if object.map_link %}
		<a href="{{object.map_link}}">{{ object.location }}</a>
		{% else %}
		{{ object.location }}
		{% endif %}</p>
		{% endcomment %}

        {% if object.is_geocoded %}
		<div id="map"></div>
        {% endif %}

		{% if object.location_iframe %}
		<p>{{object.location_iframe|safe}}</p>
		{% endif %}

		{% if object.slogan %}
		<h4>{{ object.slogan }}</h4>
        {% endif %}

		{% if object.get_race_news %}
		<h4>Latest News</h4>
		{% for item in object.get_race_news|slice:":3" %}
		<p>&nbsp;&nbsp;{{ item.body|markdown }}</p>
		{% endfor %}
		{% endif %}
		<p><strong>Race date:</strong> {{ object.start_datetime|date:"F j, Y" }}</p>
		<p><strong>Start time:</strong> {{ object.start_datetime|time:"h:i A" }}</p>
		<p><strong>Race distance:</strong> {{ object.distance }} {# object.get_unit_display #}</p>
		{% if object.cut_off %}<p><strong>Cut off time:</strong> {{ object.cut_off }}</p>{% endif %}

		{{ object.description|markdown }}

		{% if object.course_map %}
		<p>Click <a href="{{ object.course_map }}">here</a> for a course map.</p>
		{% endif %}

		{% for sponsor in object.sponsors.all %}
        <p><a href="{{ sponsor.url }}"><img src="{{ sponsor.logo.url }}" width='90'></a></p>
        {% endfor %}

		<hr>

        {% include "includes/share.html" %}

		<hr>

		<h4>Awards</h4>

    	{{ object.awards|markdown }}</p>

		<hr>

		{% if object.race_directors.count %}
		<h4>Race Director{{ object.race_directors.count|pluralize }}</h4>
		<p>
			<ul>
			{% for race_directory in object.race_directors.all %}
				<li><a href="{% url 'member_detail' pk=race_directory.pk %}">{{ race_directory.full_hawk_name }}</a> - <a href="{{ race_directory.email|mailhide }}">contact</a></li>
			{% endfor %}
			</ul>
		</p>
		{% endif %}

		{% if not object.get_overall_results %}
			<h3>Registration</h3>

			{{ object.reg_description|markdown }}<br />

			{% comment %}
			{% if object.reg_url %}
			<p class="largest loud highlight signup text-center">
			<a href="{{ object.reg_url }}">Register online today!</a>
			</p>
			{% endif %}
			{% endcomment %}

			{% if not object.is_finished %}
			<p><a class="btn btn-lg btn-block btn-warning" href="{{ object.reg_url }}">REGISTER TODAY</a></p>
			{% endif %}

			{% if object.get_reg_dates %}
	            <p><strong><em>Entry fee:</em></strong></p>
				<ul>
				{% for reg in object.get_reg_dates %}
					<li>${{ reg.reg_cost }} until {{ reg.reg_date|date:"M d" }}</li>
				{% endfor %}
				</ul>
			{% endif %}

            {{ object.discounts|markdown }}

            {% if object.packet_pickup %}
			<h3>Packet Pickup</h3>
			{{ object.packet_pickup|markdown }}
			{% endif %}
        {% endif %}

		{% if object.lodging %}
		<hr>

		<h3>Lodging:</h3>

		<p>Lodging information can be found <a href="{{ object.lodging }}">here</a>.</p>
		{% endif %}

		{% if object.get_race_reports %}
		  {% include "races/includes/race_reports.html" %}
		{% endif %}

		{% get_race_types_for_race object as race_types %}
		{% if race_types %}
		  <hr>

		  <h3>Results:</h3>
		  <ul>
		  {% for race_type in race_types %}
			<li><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-overallresults">{{ race_type.name }} Overall Results</a></li>
			<li><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-maleresults">{{ race_type.name }} Male Results</a></li>
			<li><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-femaleresults">{{ race_type.name }} Female Results</a></li>
		  {% endfor %}
		  </ul>
		{% endif %}

		{% render_facebook_like obj=object %}

		<hr>

		<h3>Race Timeline</h3>

		<div class="row">
		    <table class="table">
		    	<tbody>
		    		<tr>
					    <td>
					    	{{ object.start_datetime|date:"F" }}<br>
					    	{{ object.start_datetime|date:"Y" }}
					    </td>
					    <td>
					    	<strong>{{ object.start_datetime|date:"M j" }}</strong><br>
					    	race day
					    </td>
					</tr>
				{% for registration in object.registration_set.all %}
		    		<tr>
					    <td>
					    	{{ registration.reg_date|date:"F" }}<br>
					    	{{ registration.reg_date|date:"Y" }}
					    </td>
					    <td>
					    	<strong>{{ registration.reg_date|date:"M j" }}</strong><br>
					    	{{ registration.description }}
			    		</td>
			    	</tr>
		    		<tr>
					    <td>
					    	{{ registration.end_date|date:"F" }}<br>
					    	{{ registration.end_date|date:"Y" }}
			    		</td>
			    		<td>
					    	<strong>{{ registration.end_date|date:"M j" }}</strong><br>
					    	registration increases to ${{ registration.reg_cost }}
					    </td>
					</tr>
			{% endfor %}
				</tbody>
			</table>
			{% get_news_for_object object as object_news %}
			{{ object_news|length }}

		</div>

		{% get_links_for_object object as link_list %}
		{% if link_list %}
		<hr>
		<h3>Links</h3>
		{% for link in link_list %}
		    <h4>{{ link.name }}</h4>
		    {{ link.description|markdown }}
		{% endfor %}
		{% endif %}


		{% get_faqs_for_object object as faq_list %}
		{% if faq_list %}
		<hr>
		<h3>Frequently Asked Questions</h3>
		{% for faq in faq_list %}
		    <h4>{{ faq.question }}</h4>
		    {{ faq.answer|markdown }}
		{% endfor %}
		{% endif %}

		<hr>

		{% get_sponsors_for_object object as sponsor_list %}
		{% if sponsor_list %}
		<h3>Sponsors</h3>
		{% for sponsor in sponsor_list %}
		    <h4>{{ sponsor.name }}</h4>
		    {{ sponsor.discount_detail|markdown }}
		{% endfor %}
		{% endif %}

		<hr>

		<h3>Spectators and Volunteers</h3>

		<hr>

		{% include "comments/comments.html" %}
	</div>

    <div class="col-md-4">
		<ul class="nav nav-pills nav-stacked">
			<li><a class="btn btn-block btn-lg btn-warning" href="{{ object.reg_url }}">REGISTER TODAY</a></li>
			<li><a class="btn btn-block btn-lg btn-success" href="{{ object.reg_url }}">Volunteer?</a></li>
			<li><a class="btn btn-block btn-default" href="#">News</a></li>
			<li><a class="btn btn-block btn-default" href="#">Register</a></li>
			<li><a class="btn btn-block btn-default" href="#">Atheletes</a></li>
			<li><a class="btn btn-block btn-default" href="#">Results</a></li>
			<li><a class="btn btn-block btn-default" href="#">Travel</a></li>
			<li><a class="btn btn-block btn-default" href="#">Volunteer</a></li>
			<li><a class="btn btn-block btn-default" href="#">Sponsors</a></li>
			<li><a class="btn btn-block btn-default" href="#">Contact</a></li>
		</ul>

        {% include "panels/meta.html" %}

        <div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Race Results</h3>
			</div>
			<ul class="list-group">
			{% for race_type in race_types %}
				<li class="list-group-item"><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-overallresults">{{ race_type.name }} Overall Results</a></li>
				<li class="list-group-item"><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-maleresults">{{ race_type.name }} Male Results</a></li>
				<li class="list-group-item"><a href="{{ object.get_absolute_url }}results/#{{ race_type.slug }}-femaleresults">{{ race_type.name }} Female Results</a></li>
			{% endfor %}
			</ul>
        </div>

        {% include "panels/share.html" %}

        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Sponsors</h3>
          </div>
          <div class="panel-body">
          </div>
        </div>

		{% get_photos_by_machine_tags object.get_machine_tags num=10 random=1 as photos_list %}
		{% include "includes/flickr_photos.html" with photos=photos_list %}
	</div>
</div>
{% endblock content %}
